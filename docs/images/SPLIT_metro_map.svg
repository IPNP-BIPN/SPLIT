<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 620" width="2200" height="1240">
  <style>
    text { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
    .stage-label { font-size: 8px; font-weight: 700; fill: #6b7280; letter-spacing: 0.5px; text-transform: uppercase; }
    .stage-num { font-size: 28px; font-weight: 800; fill: #d1d5db; }
    .proc-name { font-size: 7.5px; font-weight: 600; fill: #231f20; }
    .proc-detail { font-size: 6px; fill: #9ca3af; }
    .input-label { font-size: 6.5px; font-weight: 600; }
  </style>

  <!-- Background -->
  <rect width="1100" height="620" fill="#ededed" rx="8"/>

  <!-- Title bar -->
  <rect x="0" y="0" width="1100" height="44" fill="#3b3b3b" rx="8"/>
  <rect x="0" y="20" width="1100" height="24" fill="#3b3b3b"/>
  <text x="550" y="22" text-anchor="middle" font-size="16" font-weight="800" fill="#ffffff" letter-spacing="3">SPLIT</text>
  <text x="550" y="36" text-anchor="middle" font-size="7" fill="#a1a1aa" letter-spacing="1">SNP-Level Inspection of Parental Transcripts</text>

  <!-- STAGE labels -->
  <text x="95" y="72" class="stage-label">STAGE</text>
  <text x="68" y="100" class="stage-num">1</text>
  <text x="95" y="85" class="stage-label">Input &amp; References</text>

  <text x="355" y="72" class="stage-label">STAGE</text>
  <text x="328" y="100" class="stage-num">2</text>
  <text x="355" y="85" class="stage-label">Indexing</text>

  <text x="535" y="72" class="stage-label">STAGE</text>
  <text x="508" y="100" class="stage-num">3</text>
  <text x="535" y="85" class="stage-label">Alignment</text>

  <text x="715" y="72" class="stage-label">STAGE</text>
  <text x="688" y="100" class="stage-num">4</text>
  <text x="715" y="85" class="stage-label">Allele separation</text>

  <text x="895" y="72" class="stage-label">STAGE</text>
  <text x="868" y="100" class="stage-num">5</text>
  <text x="895" y="85" class="stage-label">Quantification</text>

  <!-- ================================================================ -->
  <!-- BLUE LINE: Sample acquisition (top track)                        -->
  <!-- ================================================================ -->
  <!-- Horizontal blue line from input capsule to FASTQs -->
  <line x1="60" y1="160" x2="290" y2="160" stroke="#0570b0" stroke-width="5" stroke-linecap="round"/>

  <!-- Input capsule -->
  <rect x="30" y="148" width="55" height="24" rx="12" fill="#0570b0"/>
  <text x="57" y="163" text-anchor="middle" font-size="7" font-weight="700" fill="#ffffff">Input</text>

  <!-- Station: RESOLVE_GEO -->
  <circle cx="120" cy="160" r="5.5" fill="#ffffff" stroke="#0570b0" stroke-width="2.5"/>
  <text x="120" y="150" text-anchor="middle" class="proc-name">RESOLVE_GEO</text>

  <!-- Station: SRA_DOWNLOAD -->
  <circle cx="200" cy="160" r="5.5" fill="#ffffff" stroke="#0570b0" stroke-width="2.5"/>
  <text x="200" y="150" text-anchor="middle" class="proc-name">SRA_DOWNLOAD</text>
  <text x="200" y="179" text-anchor="middle" class="proc-detail">fasterq-dump</text>

  <!-- FASTQs junction -->
  <rect x="265" y="152" width="50" height="16" rx="8" fill="#bdc9e1"/>
  <text x="290" y="163" text-anchor="middle" class="input-label" fill="#0570b0">FASTQs</text>

  <!-- ================================================================ -->
  <!-- PURPLE LINE: Reference download + genome prep (middle track)     -->
  <!-- ================================================================ -->
  <line x1="60" y1="280" x2="290" y2="280" stroke="#6a51a3" stroke-width="5" stroke-linecap="round"/>

  <!-- Ref capsule -->
  <rect x="20" y="268" width="65" height="24" rx="12" fill="#6a51a3"/>
  <text x="52" y="283" text-anchor="middle" font-size="7" font-weight="700" fill="#ffffff">References</text>

  <!-- Station: DOWNLOAD_REFERENCES -->
  <circle cx="130" cy="280" r="5.5" fill="#ffffff" stroke="#6a51a3" stroke-width="2.5"/>
  <text x="130" y="270" text-anchor="middle" class="proc-name">DOWNLOAD_REFERENCES</text>
  <text x="130" y="299" text-anchor="middle" class="proc-detail">FASTA + GTF + VCF</text>
  <text x="130" y="308" text-anchor="middle" class="proc-detail">GRCm39 / Ensembl / MGP</text>

  <!-- Station: SNPSPLIT_GENOME_PREP -->
  <circle cx="240" cy="280" r="5.5" fill="#ffffff" stroke="#6a51a3" stroke-width="2.5"/>
  <text x="240" y="270" text-anchor="middle" class="proc-name">SNPSPLIT_GENOME_PREP</text>
  <text x="240" y="299" text-anchor="middle" class="proc-detail">dual-hybrid N-masking</text>

  <!-- Output labels from genome prep -->
  <rect x="278" y="272" width="50" height="16" rx="8" fill="#cbc9e2"/>
  <text x="303" y="283" text-anchor="middle" class="input-label" fill="#6a51a3">N-mask</text>

  <!-- ================================================================ -->
  <!-- ESTIMATE READ LENGTH (gray, from blue FASTQs going down)         -->
  <!-- ================================================================ -->
  <!-- Blue line drops from FASTQs down to read length estimate -->
  <path d="M290,168 L290,220 L370,220" stroke="#0570b0" stroke-width="3" stroke-linecap="round" fill="none" stroke-dasharray="6,3"/>

  <!-- Gray line for estimate read length -->
  <line x1="370" y1="220" x2="440" y2="220" stroke="#999999" stroke-width="4" stroke-linecap="round"/>
  <circle cx="400" cy="220" r="5" fill="#ffffff" stroke="#999999" stroke-width="2.5"/>
  <text x="400" y="210" text-anchor="middle" class="proc-name">ESTIMATE_READ_LENGTH</text>
  <text x="400" y="234" text-anchor="middle" class="proc-detail">sjdbOverhang</text>

  <!-- ================================================================ -->
  <!-- FORK into two tracks: N-mask (orange) and Reference (green)      -->
  <!-- ================================================================ -->

  <!-- Fork dot -->
  <circle cx="440" cy="220" r="3.5" fill="#999999"/>

  <!-- ================================================================ -->
  <!-- ORANGE LINE: N-masked track (upper)                              -->
  <!-- ================================================================ -->
  <!-- Orange horizontal line -->
  <line x1="440" y1="160" x2="1050" y2="160" stroke="#e6550d" stroke-width="5" stroke-linecap="round"/>
  <!-- Fork up from gray to orange -->
  <path d="M440,220 L440,160" stroke="#e6550d" stroke-width="5" stroke-linecap="round" fill="none"/>

  <!-- N-masked FASTA feeds into STAR_INDEX N-mask (from genome prep) -->
  <path d="M303,280 C340,280 380,200 440,168" stroke="#6a51a3" stroke-width="2" stroke-dasharray="5,3" fill="none" opacity="0.5"/>

  <!-- GTF feeds into STAR_INDEX (dashed gray from DOWNLOAD_REFERENCES) -->
  <path d="M135,286 C160,340 320,360 370,360 L370,320 C370,280 430,200 475,168" stroke="#999999" stroke-width="1.5" stroke-dasharray="3,3" fill="none" opacity="0.3"/>

  <!-- Station: STAR_INDEX (N-mask) -->
  <circle cx="480" cy="160" r="5.5" fill="#ffffff" stroke="#e6550d" stroke-width="2.5"/>
  <text x="480" y="150" text-anchor="middle" class="proc-name">STAR_INDEX</text>
  <text x="480" y="174" text-anchor="middle" class="proc-detail">(N-mask)</text>

  <!-- FASTQs feed into STAR_ALIGN (dashed blue from above) -->
  <path d="M290,160 C310,160 340,160 540,160" stroke="#0570b0" stroke-width="2" stroke-dasharray="5,3" fill="none" opacity="0.35"/>

  <!-- Station: STAR_ALIGN (N-mask) -->
  <circle cx="580" cy="160" r="5.5" fill="#ffffff" stroke="#e6550d" stroke-width="2.5"/>
  <text x="580" y="150" text-anchor="middle" class="proc-name">STAR_ALIGN</text>
  <text x="580" y="174" text-anchor="middle" class="proc-detail">(N-mask)</text>

  <!-- Station: SORT_DEDUP (N-mask) -->
  <circle cx="660" cy="160" r="5.5" fill="#ffffff" stroke="#e6550d" stroke-width="2.5"/>
  <text x="660" y="150" text-anchor="middle" class="proc-name">SORT_DEDUP</text>
  <text x="660" y="174" text-anchor="middle" class="proc-detail">samtools</text>

  <!-- Station: SNPSPLIT (key step - bigger dot) -->
  <circle cx="760" cy="160" r="7" fill="#cb181d" stroke="#99000d" stroke-width="2"/>
  <text x="760" y="148" text-anchor="middle" class="proc-name" style="font-size:8px;font-weight:700;fill:#99000d">SNPSPLIT</text>
  <text x="760" y="174" text-anchor="middle" class="proc-detail">allele separation</text>

  <!-- SNP file feeds into SNPSPLIT (dashed pink from genome prep) -->
  <path d="M248,286 C280,350 500,370 680,300 C720,282 745,200 753,167" stroke="#cb181d" stroke-width="2" stroke-dasharray="5,3" fill="none" opacity="0.4"/>
  <text x="520" y="348" class="proc-detail" style="fill:#cb181d;font-style:italic">SNP file</text>

  <!-- SNPSPLIT forks into genome1 (gold) and genome2 (purple) -->
  <!-- genome1 line goes up-right -->
  <path d="M767,160 C790,160 830,130 870,130" stroke="#d4a017" stroke-width="4" stroke-linecap="round" fill="none"/>
  <!-- genome2 line goes down-right -->
  <path d="M767,160 C790,160 830,190 870,190" stroke="#6a51a3" stroke-width="4" stroke-linecap="round" fill="none"/>

  <!-- Continue orange to end for the fork lines -->
  <!-- genome1 horizontal -->
  <line x1="870" y1="130" x2="1000" y2="130" stroke="#d4a017" stroke-width="4" stroke-linecap="round"/>
  <!-- genome2 horizontal -->
  <line x1="870" y1="190" x2="1000" y2="190" stroke="#6a51a3" stroke-width="4" stroke-linecap="round"/>

  <!-- Station: FEATURECOUNTS genome1 -->
  <circle cx="940" cy="130" r="5.5" fill="#ffffff" stroke="#d4a017" stroke-width="2.5"/>
  <text x="940" y="120" text-anchor="middle" class="proc-name">FEATURECOUNTS</text>
  <text x="940" y="142" text-anchor="middle" class="proc-detail">genome1 (CAST_EiJ)</text>

  <!-- Station: FEATURECOUNTS genome2 -->
  <circle cx="940" cy="190" r="5.5" fill="#ffffff" stroke="#6a51a3" stroke-width="2.5"/>
  <text x="940" y="207" text-anchor="middle" class="proc-name">FEATURECOUNTS</text>
  <text x="940" y="217" text-anchor="middle" class="proc-detail">genome2 (C57BL_6NJ)</text>

  <!-- Terminal dots -->
  <circle cx="1000" cy="130" r="3.5" fill="#d4a017"/>
  <circle cx="1000" cy="190" r="3.5" fill="#6a51a3"/>

  <!-- ================================================================ -->
  <!-- GREEN LINE: Reference track (lower)                              -->
  <!-- ================================================================ -->
  <line x1="440" y1="340" x2="1000" y2="340" stroke="#238b45" stroke-width="5" stroke-linecap="round"/>
  <!-- Fork down from gray to green -->
  <path d="M440,220 L440,340" stroke="#238b45" stroke-width="5" stroke-linecap="round" fill="none"/>

  <!-- Ref FASTA feeds into STAR_INDEX Ref (from DOWNLOAD_REFERENCES) -->
  <path d="M135,286 C160,360 300,400 390,380 C430,370 458,355 472,347" stroke="#6a51a3" stroke-width="2" stroke-dasharray="5,3" fill="none" opacity="0.4"/>

  <!-- GTF feeds into STAR_INDEX Ref (dashed gray) -->
  <path d="M370,360 C400,360 440,350 475,347" stroke="#999999" stroke-width="1.5" stroke-dasharray="3,3" fill="none" opacity="0.3"/>

  <!-- Station: STAR_INDEX (Ref) -->
  <circle cx="480" cy="340" r="5.5" fill="#ffffff" stroke="#238b45" stroke-width="2.5"/>
  <text x="480" y="330" text-anchor="middle" class="proc-name">STAR_INDEX</text>
  <text x="480" y="354" text-anchor="middle" class="proc-detail">(Reference)</text>

  <!-- FASTQs feed into STAR_ALIGN Ref (dashed blue) -->
  <path d="M290,168 C310,200 350,300 540,338" stroke="#0570b0" stroke-width="2" stroke-dasharray="5,3" fill="none" opacity="0.3"/>

  <!-- Station: STAR_ALIGN (Ref) -->
  <circle cx="580" cy="340" r="5.5" fill="#ffffff" stroke="#238b45" stroke-width="2.5"/>
  <text x="580" y="330" text-anchor="middle" class="proc-name">STAR_ALIGN</text>
  <text x="580" y="354" text-anchor="middle" class="proc-detail">(Reference)</text>

  <!-- Station: SORT_DEDUP (Ref) -->
  <circle cx="660" cy="340" r="5.5" fill="#ffffff" stroke="#238b45" stroke-width="2.5"/>
  <text x="660" y="330" text-anchor="middle" class="proc-name">SORT_DEDUP</text>
  <text x="660" y="354" text-anchor="middle" class="proc-detail">samtools</text>

  <!-- Station: FEATURECOUNTS ref -->
  <circle cx="940" cy="340" r="5.5" fill="#ffffff" stroke="#238b45" stroke-width="2.5"/>
  <text x="940" y="330" text-anchor="middle" class="proc-name">FEATURECOUNTS</text>
  <text x="940" y="354" text-anchor="middle" class="proc-detail">reference (standard)</text>

  <!-- Terminal dot -->
  <circle cx="1000" cy="340" r="3.5" fill="#238b45"/>

  <!-- GTF feeds into all FEATURECOUNTS (dashed gray horizontal) -->
  <path d="M370,360 L880,360 C900,360 920,350 933,347" stroke="#999999" stroke-width="1.5" stroke-dasharray="3,3" fill="none" opacity="0.25"/>
  <path d="M880,360 C890,340 900,300 910,260 C915,240 920,200 933,197" stroke="#999999" stroke-width="1.2" stroke-dasharray="3,3" fill="none" opacity="0.2"/>
  <path d="M880,360 C890,320 900,250 910,200 C915,170 920,145 933,137" stroke="#999999" stroke-width="1.2" stroke-dasharray="3,3" fill="none" opacity="0.2"/>
  <text x="370" y="373" class="proc-detail" style="fill:#999999;font-style:italic">GTF</text>

  <!-- ================================================================ -->
  <!-- MULTIQC (converging to bottom)                                   -->
  <!-- ================================================================ -->
  <!-- Lines from all endpoints converge -->
  <path d="M1000,135 C1020,135 1040,160 1050,250 C1055,320 1050,400 1050,440" stroke="#d4a017" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.4"/>
  <path d="M1000,195 C1020,195 1035,220 1045,300 C1050,350 1050,400 1050,440" stroke="#6a51a3" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.4"/>
  <path d="M1000,345 C1020,345 1035,370 1045,400 C1050,420 1050,430 1050,440" stroke="#238b45" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.4"/>

  <!-- MultiQC line -->
  <line x1="1050" y1="440" x2="1050" y2="490" stroke="#14b8a6" stroke-width="5" stroke-linecap="round"/>
  <circle cx="1050" cy="470" r="6" fill="#ffffff" stroke="#14b8a6" stroke-width="2.5"/>
  <text x="1050" y="460" text-anchor="middle" class="proc-name" style="font-size:8px;font-weight:700">MULTIQC</text>
  <circle cx="1050" cy="490" r="3.5" fill="#14b8a6"/>

  <!-- ================================================================ -->
  <!-- LEGEND                                                           -->
  <!-- ================================================================ -->
  <rect x="30" y="430" width="360" height="170" rx="6" fill="#f5f5f5" stroke="#d4d4d4" stroke-width="1"/>
  <text x="50" y="452" font-size="9" font-weight="700" fill="#374151">LEGEND</text>

  <line x1="50" y1="470" x2="80" y2="470" stroke="#0570b0" stroke-width="4" stroke-linecap="round"/>
  <text x="90" y="474" font-size="7.5" fill="#6b7280">Sample acquisition</text>

  <line x1="50" y1="490" x2="80" y2="490" stroke="#6a51a3" stroke-width="4" stroke-linecap="round"/>
  <text x="90" y="494" font-size="7.5" fill="#6b7280">Reference preparation</text>

  <line x1="50" y1="510" x2="80" y2="510" stroke="#e6550d" stroke-width="4" stroke-linecap="round"/>
  <text x="90" y="514" font-size="7.5" fill="#6b7280">N-masked track (allele-specific)</text>

  <line x1="50" y1="530" x2="80" y2="530" stroke="#238b45" stroke-width="4" stroke-linecap="round"/>
  <text x="90" y="534" font-size="7.5" fill="#6b7280">Reference track (standard)</text>

  <line x1="50" y1="550" x2="80" y2="550" stroke="#d4a017" stroke-width="4" stroke-linecap="round"/>
  <text x="90" y="554" font-size="7.5" fill="#6b7280">genome1 (CAST_EiJ)</text>

  <line x1="50" y1="570" x2="80" y2="570" stroke="#6a51a3" stroke-width="3" stroke-linecap="round" stroke-dasharray="1,0"/>
  <text x="90" y="574" font-size="7.5" fill="#6b7280">genome2 (C57BL_6NJ)</text>

  <circle cx="230" cy="470" r="4" fill="#ffffff" stroke="#888888" stroke-width="2"/>
  <text x="242" y="474" font-size="7.5" fill="#6b7280">Process station</text>

  <circle cx="230" cy="490" r="5" fill="#cb181d" stroke="#99000d" stroke-width="1.5"/>
  <text x="242" y="494" font-size="7.5" fill="#6b7280">Key step (SNPsplit)</text>

  <line x1="220" y1="510" x2="250" y2="510" stroke="#999999" stroke-width="1.5" stroke-dasharray="4,3"/>
  <text x="258" y="514" font-size="7.5" fill="#6b7280">Data flow (FASTA/VCF/GTF/SNP)</text>

  <circle cx="230" cy="530" r="3" fill="#888888"/>
  <text x="242" y="534" font-size="7.5" fill="#6b7280">Terminal / fork point</text>

  <!-- Default strains box -->
  <rect x="30" y="380" width="360" height="40" rx="6" fill="#f5f5f5" stroke="#d4d4d4" stroke-width="1"/>
  <text x="50" y="398" font-size="7" font-weight="600" fill="#374151">Default strains:</text>
  <text x="145" y="398" font-size="7" fill="#d4a017" font-weight="600">CAST_EiJ</text>
  <text x="195" y="398" font-size="7" fill="#6b7280">x</text>
  <text x="208" y="398" font-size="7" fill="#6a51a3" font-weight="600">C57BL_6NJ</text>
  <text x="50" y="412" font-size="6.5" fill="#9ca3af">VCF: MGP REL2021 v8  |  Genome: GRCm39  |  GTF: Ensembl geneset</text>

  <!-- Footer -->
  <text x="550" y="612" text-anchor="middle" font-size="7" fill="#d1d5db">github.com/IPNP-BIPN/SPLIT</text>
</svg>